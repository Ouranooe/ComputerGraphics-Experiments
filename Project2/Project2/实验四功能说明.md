# 实验四 三维基本图形生成及变换 - 功能说明

## 已实现的功能

### 1. 基本三维图形绘制 ✓
- **球体 (Sphere)**: 使用经纬度方法生成，16个经线切片，12个纬线堆叠
- **六面体 (Cube)**: 标准立方体，6个面，每面2个三角形
- **柱体 (Cylinder)**: 圆柱体，20个侧面切片，包含顶面和底面
- **平面 (Ground)**: 大型地面平面，用于场景参考

**使用方法**: 切换到3D模式后，通过菜单"3D图元"选择要添加的图形

### 2. 鼠标选择物体 ✓
- **单击左键**: 循环选择场景中的物体
- **选中状态**: 被选中的物体会显示为高亮（更亮的颜色）并带有黄色线框

### 3. 鼠标控制物体移动 ✓

#### 移动选中的物体
- **左键拖拽**: 在世界坐标XY平面内移动选中的物体
- **鼠标滚轮**: 沿Z轴（深度方向）移动选中的物体

#### 控制相机视角（未选中物体时）
- **左键拖拽**: 绕目标点旋转相机
  - 水平拖动：水平旋转相机
  - 垂直拖动：垂直移动相机
- **右键拖拽**: 平移相机和目标点
  - 水平拖动：左右平移
  - 垂直拖动：上下平移
- **中键拖拽**: 沿视线方向缩放（向前/向后移动）
- **鼠标滚轮**: 沿视线方向缩放（未选中物体时）

### 4. 物体变换对话框 ✓
- **打开方式**: 选中物体后双击左键
- **可修改参数**:
  - 位置坐标 (X, Y, Z)
  - 旋转角度 (绕X轴、Y轴、Z轴，单位：度)
  - 缩放因子 (X, Y, Z方向，以百分比表示)

### 5. 光照系统 ✓
- **光源类型**: 方向光（平行光）
- **光照模型**: 简化的Phong光照模型（环境光 + 漫反射）
- **光源设置**: 通过菜单"场景设置 → 光源设置"打开对话框
- **可调参数**:
  - 光源位置 (X, Y, Z)
  - 光照强度（环境光20% + 漫反射80%）

### 6. 材质设置 ✓
- **打开方式**: 
  - 方式1：选中物体后按Ctrl+双击
  - 方式2：通过菜单"编辑 → 物体材质与纹理"
- **可调参数**:
  - 环境光反射系数 (Ambient)
  - 漫反射系数 (Diffuse) - 决定物体的基本颜色
  - 镜面反射系数 (Specular)
  - 光泽度 (Shininess)

### 7. 纹理贴图 ✓
- **支持格式**: BMP, JPG, PNG
- **启用纹理**: 在材质对话框中勾选"启用纹理"
- **加载纹理**: 点击"选择纹理"按钮选择图片文件
- **纹理映射方式**:
  - 重复 (Repeat): 纹理在物体表面重复平铺
  - 截断 (Clamp): 纹理边缘颜色延伸到边界

## 初始场景

切换到3D模式时，系统会自动创建一个初始场景：
- 1个带旋转的橙色立方体（位于中心）
- 1个绿色地面平面（位于下方）
- 蓝灰色背景

## 渲染技术

- **投影方式**: 透视投影
- **消隐算法**: 画家算法（按深度排序）+ 背面剔除
- **着色方式**: 平面着色 (Flat Shading)
- **渲染管线**: 软件光栅化 + Direct2D绘制

## 操作提示

程序运行时，左上角会显示实时的操作提示和相机/光源信息：
- 当前操作模式（是否选中物体）
- 鼠标和滚轮的功能说明
- 相机位置坐标
- 光源位置坐标

## 模式切换

- 通过菜单"系统 → 返回2D模式"或"系统 → 切换到3D模式"可以在2D和3D模式间切换
- 切换模式会自动更新菜单项

## 技术实现要点

1. **3D数学**: 实现了矩阵变换、透视投影、LookAt相机等
2. **几何生成**: 参数化生成球体、圆柱体等复杂几何体
3. **光照计算**: 法线变换、漫反射计算
4. **材质系统**: 支持环境光、漫反射、镜面反射参数
5. **纹理系统**: 使用WIC加载图片，D2D渲染纹理
6. **交互设计**: 完整的鼠标交互和键盘修饰键支持

## 已满足的实验要求

✅ (1) 绘制基本三维图形（球体、柱体、平面、六面体）
✅ (2) 鼠标选择和移动实体
✅ (3) 对话框修改位置、旋转、缩放
✅ (4) 鼠标控制视角运动
✅ (5) 设置光源位置和光照参数
✅ (6) 修改材质参数
✅ (7) 纹理贴图及映射方式

所有实验要求均已完整实现！
